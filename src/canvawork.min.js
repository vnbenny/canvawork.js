/**
 * Canva Work - fast single or multple image, canvas, base64 & blob conversion, resizing and watermarking
 * Author: VNBenny
 * Website: https://vnbenny.com
 * Author github: https://github.com/vnbenny
 * Github repository:
 */
function CanvaWork(a){var b=this;if(this.convertCount=0,this.totalCount=0,this.returnArray=[],this.returnNormal=!0,this.size="full",this.errors=[],this.watermark=!1,this.file=!1,this.options={file:"",watermark_file:"",watermark:!1,sizes:{big:{width:1200,height:400,watermark_decrease:80},med:{width:600,height:200,watermark_decrease:50},thumb:{width:300,height:100,watermark_decrease:30}},file_type:"image/png",file_quality:"1.0",debug:!1},this.options=Object.assign(this.options,a),this.debug&&console.log(this.options),this.Callback=function(a,c){if(b.debug&&console.warn("CALLBACK"),b.returnArray.push(a),b.convertCount++,b.convertCount==b.totalCount){var d=b.returnArray;b.returnArray=[],b.convertCount=0,b.totalCount=0,b.returnNormal=!0,b.setSize="full",window[c(d)]}},this.setSize=function(a){"big"==a||"med"==a||"thumb"==a?b.size=a:b.size="full"},this.getSizes=function(){return b.options.sizes[b.size]},this.debug=function(){return b.options.debug},this.setError=function(a){b.errors.push(a)},this.canvasToBlob=function(a,c,d){a instanceof Array?(b.debug()&&console.log("Multiple - canvasToBlob"),b.totalCount=a.length,$.each(a,function(a,d){b.canvasToBlob(d,b.Callback,c)})):(b.debug()&&console.log("Single - canvasToBlob"),a.toDataURL(b.options.file_type,b.options.file_quality),a.toBlob(function(a){window[c(a,d)]}))},this.canvasToBase64=function(a,c,d){var e=[];b.debug()&&console.log("Full - canvasToBase64"),a instanceof Array?$.each(a,function(a,c){e.push(c.toDataURL(b.options.file_type,b.options.file_quality))}):e=a.toDataURL(b.options.file_type,b.options.file_quality),window[c(e,d)]},this.base64ToCanvas=function(a,c,d){var e=b.getSizes();if(a instanceof Array)b.debug()&&console.log("Multiple - base64ToCanvas"),b.totalCount=a.length,$.each(a,function(a,d){b.base64ToCanvas(d,b.Callback,c)});else{b.debug()&&console.log("Single - base64ToCanvas");var f=document.createElement("canvas"),g=new Image;g.src=a,g.onload=function(){"full"==b.size?(f.width=g.naturalWidth,f.height=g.naturalHeight):(f.width=e.width,f.height=e.height);var a=f.getContext("2d");if(a.drawImage(g,0,0,f.width,f.height),b.watermark){var h=b.watermark.width,i=b.watermark.height;e&&(h=b.watermark.width*(e.watermark_decrease/100)),e&&(i=b.watermark.height*(e.watermark_decrease/100)),a.drawImage(b.watermark.image,10,10,h,i)}window[c(f,d)]}}},this.base64ToBlob=function(a,c,d){b.debug()&&console.log("Warp - base64ToBlob"),b.base64ToCanvas(a,function(a){b.canvasToBlob(a,function(a){window[c(a)]})})},this.base64ToImage=function(a,c,d){b.debug()&&console.log("Full - canvasToBase64");var e=[];a instanceof Array?$.each(a,function(a,b){e.push('<img src="'+b+'">')}):e='<img src="'+a+'">',window[c(e,d)]},this.blobToBase64=function(a,c,d){if(a instanceof Array)b.debug()&&console.log("Multiple - blobToBase64"),b.totalCount=a.length,$.each(a,function(a,d){b.blobToBase64(d,b.Callback,c)});else{b.debug()&&console.log("Single - blobToBase64");var e=new window.FileReader;e.readAsDataURL(a),e.onloadend=function(){window[c(e.result,d)]}}},this.blobToCanvas=function(a,c,d){b.debug()&&console.log("Warp - blobToCanvas"),b.blobToBase64(a,function(a){b.base64ToCanvas(a,function(a){window[c(a)]})})},this.canvasResizeAll=function(a,c){b.debug()&&console.log("Tools - canvasResizeAll"),b.canvasToBase64(a,function(a){var d=[];b.setSize("big"),b.base64ToCanvas(a,function(e){d.push(e),b.setSize("med"),b.base64ToCanvas(a,function(e){d.push(e),b.setSize("thumb"),b.base64ToCanvas(a,function(a){d.push(a),window[c(d)]})})})})},this.canvasResizePrecent=function(a,c,d){b.debug()&&console.log("Tools - canvasResizePrecent"),b.canvasToBase64(a,function(a){var e=document.createElement("canvas"),f=new Image;f.src=a,f.onload=function(){e.width=f.naturalWidth*(c/100),e.height=f.naturalHeight*(c/100);var a=e.getContext("2d");a.drawImage(f,0,0,e.width,e.height),b.watermark&&a.drawImage(b.watermark.image,10,10,b.watermark.width,b.watermark.height),window[d(e)]}})},this.loadImage=function(a,c){b.debug()&&console.log("Tools - loadImage"),a||(a=b.options.file);var d=document.createElement("canvas"),e=new Image;e.src=a,e.onload=function(){d.width=e.naturalWidth,d.height=e.naturalHeight;var a=d.getContext("2d");a.drawImage(e,0,0,d.width,d.height),b.file={image:e,canvas:d,width:d.width,height:d.height},window[c(b.file)]},e.onError=function(a){b.setError(a)}},this.options.watermark){b.debug()&&console.warn("STARTUP");var c=document.createElement("canvas"),d=new Image;d.src=this.options.watermark_file,d.onload=function(){c.width=d.naturalWidth,c.height=d.naturalHeight;var a=c.getContext("2d");a.drawImage(d,0,0,c.width,c.height),b.watermark={image:d,canvas:c,width:c.width,height:c.height}}}this.options.file.length>0&&this.loadImage(null,function(a){return!1})}
